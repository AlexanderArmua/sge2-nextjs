model Reserva {
    id Int @id @default(autoincrement())

    estatus         ReservaEstatus
    fechaHoraInicio DateTime
    fechaHoraFin    DateTime
    tipo            ReservaTipo

    usuarioSolicitoId String
    usuarioSolicito   User   @relation(fields: [usuarioSolicitoId], references: [id], name: "reservasSolicitadas")

    usuarioAprobadorId String
    usuarioAprobador   User   @relation(fields: [usuarioAprobadorId], references: [id], name: "reservasAprobadas")

    usuarioRechazadoId String?
    usuarioRechazado   User?   @relation(fields: [usuarioRechazadoId], references: [id], name: "reservasRechazadas")

    usuarioRenovoId String?
    usuarioRenovo   User?   @relation(fields: [usuarioRenovoId], references: [id], name: "reservasRenovadas")

    usuarioTutorId String?
    usuarioTutor   User?   @relation(fields: [usuarioTutorId], references: [id], name: "reservaTutor")

    usuarioRecibioId String?
    usuarioRecibio   User?   @relation(fields: [usuarioRecibioId], references: [id], name: "reservasRecibidas")

    reservaEquipo             ReservaEquipo?
    reservaLibro              ReservaLibro?
    reservaLaboratorioCerrado ReservaLaboratorioCerrado?
    reservaLaboratorioAbierto ReservaLaboratorioAbierto?

    fechaRenovacion DateTime?
    fechaAprobacion DateTime?
    fechaRechazo    DateTime?
    fechaRecibido   DateTime?

    // Auditorias
    usuarioCreadorId     String
    usuarioModificadorId String
    fechaCreacion        DateTime @default(now())
    fechaModificacion    DateTime @updatedAt

    @@index([estatus])
    @@index([fechaHoraInicio(sort: Asc)])
    @@index([fechaHoraFin(sort: Asc)])
    @@index([tipo])
}

model ReservaEquipo {
    id Int @id @default(autoincrement())

    fechaEntregado DateTime
    numeroReserva  Int // TODO: QUE ES? Se puede reemplazar por `reserva.codigo`?

    reservaId Int     @unique
    reserva   Reserva @relation(fields: [reservaId], references: [id])

    equipoId Int
    equipo   Equipo @relation(fields: [equipoId], references: [id])

    fechaCreacion        DateTime @default(now())
    fechaModificacion    DateTime @default(now()) @updatedAt
    usuarioCreadorId     String
    usuarioModificadorId String

    @@index([fechaEntregado(sort: Asc)])
}

model ReservaLibro {
    id Int @id @default(autoincrement())

    fechaEntregado DateTime

    reservaId Int     @unique
    reserva   Reserva @relation(fields: [reservaId], references: [id])

    libroId Int
    libro   Libro @relation(fields: [libroId], references: [id])

    fechaCreacion        DateTime @default(now())
    fechaModificacion    DateTime @default(now()) @updatedAt
    usuarioCreadorId     String
    usuarioModificadorId String

    @@index([fechaEntregado(sort: Asc)])
}

model ReservaLaboratorioCerrado {
    id Int @id @default(autoincrement())

    reservaId Int     @unique
    reserva   Reserva @relation(fields: [reservaId], references: [id])

    laboratorioId Int
    laboratorio   Laboratorio @relation(fields: [laboratorioId], references: [id])

    cursoId Int
    curso   Curso @relation(fields: [cursoId], references: [id])

    equipoReservado ReservaLaboratorioCerradoEquipo[]

    fechaCreacion        DateTime @default(now())
    fechaModificacion    DateTime @default(now()) @updatedAt
    usuarioCreadorId     String
    usuarioModificadorId String
}

model ReservaLaboratorioCerradoEquipo {
    id Int @id @default(autoincrement())

    cantidad Int

    reservaLaboratorioCerradoId Int
    reservaLaboratorioCerrado   ReservaLaboratorioCerrado @relation(fields: [reservaLaboratorioCerradoId], references: [id])

    equipoId Int
    equipo   Equipo @relation(fields: [equipoId], references: [id])

    fechaCreacion        DateTime @default(now())
    fechaModificacion    DateTime @default(now()) @updatedAt
    usuarioCreadorId     String
    usuarioModificadorId String
}

model ReservaLaboratorioAbierto {
    id Int @id @default(autoincrement())

    especialidad   String
    descripcion    String
    numeroReserva  Int // TODO: QUE ES?
    mailConfirmado Boolean

    reservaId Int     @unique
    reserva   Reserva @relation(fields: [reservaId], references: [id])

    laboratorioId Int
    laboratorio   Laboratorio @relation(fields: [laboratorioId], references: [id])

    equipoReservado ReservaLaboratorioAbiertoEquipo[]

    fechaCreacion        DateTime @default(now())
    fechaModificacion    DateTime @default(now()) @updatedAt
    usuarioCreadorId     String
    usuarioModificadorId String

    @@index([especialidad(sort: Asc)])
    @@index([numeroReserva(sort: Asc)])
    @@index([mailConfirmado], type: Hash)
}

model ReservaLaboratorioAbiertoEquipo {
    id Int @id @default(autoincrement())

    cantidad Int

    reservaLaboratorioAbiertoId Int
    reservaLaboratorioAbierto   ReservaLaboratorioAbierto @relation(fields: [reservaLaboratorioAbiertoId], references: [id])

    equipoId Int
    equipo   Equipo @relation(fields: [equipoId], references: [id])

    fechaCreacion        DateTime @default(now())
    fechaModificacion    DateTime @default(now()) @updatedAt
    usuarioCreadorId     String
    usuarioModificadorId String
}

enum ReservaEstatus {
    PENDIENTE
    FINALIZADA
    CANCELADA
}

enum ReservaTipo {
    LABORATORIO_ABIERTO
    LABORATORIO_CERRADO
    INVENTARIO
    LIBRO
}
